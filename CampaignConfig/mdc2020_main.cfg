[stage_main_digi]

job_setup.prescript_1 = source /cvmfs/mu2e.opensciencegrid.org/bin/prodtools/v1.3.1/bin/setup.sh
job_setup.prescript_2 = echo '#include "Production/JobConfig/digitize/OnSpill.fcl"' > template.fcl
job_setup.prescript_3 = echo 'services.DbService.purpose: "MDC2020_{dbpurpose}"' >> template.fcl
job_setup.prescript_4 = echo 'services.DbService.version: "{dbversion}"' >> template.fcl
job_setup.prescript_5 = echo 'services.DbService.verbose: 2' >> template.fcl
job_setup.prescript_6 = echo 'services.SeedService.baseSeed: "{seed}"' >> template.fcl
job_setup.prescript_7 = echo 'outputs.TriggeredOutput.fileName:   "dig.mu2e.{desc}OnSpillTriggered.MDC2020{release}_{dbpurpose}_{dbversion}.{sequence}.art"' >> template.fcl
job_setup.prescript_8 = echo 'outputs.TriggerableOutput.fileName: "dig.mu2e.{desc}OnSpillTriggerable.MDC2020{release}_{dbpurpose}_{dbversion}.{sequence}.art"' >> template.fcl

executable.name = runfcl
executable.arg_1 = --fcl template.fcl
executable.arg_2 = --release %(release_v_o)s
executable.arg_3 = --dbpurpose perfect
executable.arg_4 = --dbversion %(dbversion)s
executable.arg_5 = --outloc %(outloc)s

executable_2.name = runfcl
executable_2.arg_1 = --fcl template.fcl
executable_2.arg_2 = --release %(release_v_o)s
executable_2.arg_3 = --dbpurpose best
executable_2.arg_4 = --dbversion %(dbversion)s
executable_2.arg_5 = --outloc %(outloc)s

submit.n_files_per_job = 1
job_setup.multifile = True

[stage_main_reco]
job_setup.prescript_1 = source /cvmfs/mu2e.opensciencegrid.org/bin/prodtools/v1.3.1/bin/setup.sh
job_setup.prescript_2 = echo '#include "Production/JobConfig/reco/OnSpill.fcl"' > template.fcl
job_setup.prescript_3 = echo 'services.DbService.purpose: "MDC2020_{dbpurpose}"' >> template.fcl
job_setup.prescript_4 = echo 'services.DbService.version: "{dbversion}"' >> template.fcl
job_setup.prescript_5 = echo 'services.DbService.verbose: 2' >> template.fcl
job_setup.prescript_6 = echo 'outputs.LoopHelixOutput.fileName: "mcs.mu2e.{desc}.{dsconf}.{sequence}.art"' >> template.fcl

executable.name = runfcl
executable.arg_1 = --fcl template.fcl
executable.arg_2 = --release %(release_v_o)s
executable.arg_3 = --outloc %(outloc)s

submit.n_files_per_job = 1
submit.disk = 80GB
job_setup.multifile = True

[stage_main_evntuple]

job_setup.prescript_1 = source /cvmfs/mu2e.opensciencegrid.org/bin/prodtools/v1.3.1/bin/setup.sh
job_setup.prescript_2 = echo '#include "EventNtuple/fcl/from_mcs-mockdata.fcl"' > template.fcl
job_setup.prescript_3 = echo 'services.TFileService.fileName: "nts.mu2e.{desc}.{dsconf}_%(ntuple)s.{sequence}.root"' >> template.fcl


executable.name = runfcl
executable.arg_1 = --fcl template.fcl
executable.arg_2 = --setup /cvmfs/mu2e.opensciencegrid.org/Musings/EventNtuple/%(ntuple)s/setup.sh
executable.arg_3 = --outloc %(outloc)s

submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True

[stage_main_evntuple_test]

job_setup.source_1 = /cvmfs/mu2e.opensciencegrid.org/setupmu2e-art.sh
job_setup.source_2 = ${MUSE_DIR}/bin/muse setup ops
job_setup.source_3 = ${MUSE_DIR}/bin/muse setup SimJob MDC2020az

executable.name = muse
executable.arg_1 = status

submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True
env_pass.MOO_CONFIG = simjob-mdc2020


[stage_main_runjobdef]

global.nevts = -1

submit.f_3=dropbox:///exp/mu2e/app/users/mu2epro/production_manager/poms_map/%(map)s
submit.f_4=dropbox:///exp/mu2e/app/users/oksuzian/muse_050125/prodtools.tar.gz
job_setup.prescript_1 = tar -xzf $CONDOR_DIR_INPUT/prodtools.tar.gz -C $CONDOR_DIR_INPUT/
job_setup.prescript_2 = source $CONDOR_DIR_INPUT/prodtools/setup.sh
job_setup.prescript_3 = chmod +x ${CONDOR_DIR_INPUT}/prodtools/runjobdef 2>/dev/null
job_setup.prescript_4 = ls -ltr ${CONDOR_DIR_INPUT}/prodtools/

executable.name = runjobdef
executable.arg_1 = --jobdefs \\\\\\\$CONDOR_DIR_INPUT/%(map)s
executable.arg_2 = --nevts %(nevts)s
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True


[stage_main_runjobdef_cvmfs]

global.nevts = -1

submit.f=dropbox:///exp/mu2e/app/users/mu2epro/production_manager/poms_map/%(map)s
job_setup.prescript = source /cvmfs/mu2e.opensciencegrid.org/bin/prodtools/v1.3.1/bin/setup.sh

executable_1.name = runjobdef
executable_1.arg_1 = --jobdefs \\\\\\\$CONDOR_DIR_INPUT/%(map)s
executable_1.arg_2 = --nevts %(nevts)s
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True

[stage_main_runjobdef_nersc]

global.nevts = 1000

submit.f=dropbox:///exp/mu2e/app/users/mu2epro/production_manager/poms_map/%(map)s
job_setup.prescript = source /cvmfs/mu2e.opensciencegrid.org/bin/prodtools/v1.3.1/bin/setup.sh

executable_1.name = runjobdef
executable_1.arg_1 = --jobdefs \\\\\\\$CONDOR_DIR_INPUT/%(map)s
executable_1.arg_2 = --nevts %(nevts)s
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True
submit.OS = EL9
submit.site = NERSC-Perlmutter-CPU
submit.l = '+DUMMY_SINGULARITY=""'
submit.append_condor_requirements = ''


[stage_main_simple_test]
executable.name = httokendecode
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True
env_pass.MOO_CONFIG = simjob-mdc2020


[stage_main_validation]

global.simjob_setup=$(ls -t /cvmfs/mu2e-development.opensciencegrid.org/museCIBuild/main/*/setup.sh | head -1)
submit.f_4=dropbox:///exp/mu2e/app/users/oksuzian/local_validation/test_single_job.sh
job_setup.prescript_1 = echo '#include "Production/Validation/nightly/MDS/digitize.fcl"' > template.fcl

executable.name = \\\\\\\$CONDOR_DIR_INPUT/test_single_job.sh
executable.arg_1 = --fcl template.fcl

submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True
env_pass.MOO_CONFIG = simjob-mdc2020